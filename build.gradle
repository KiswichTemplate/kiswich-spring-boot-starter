/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Kotlin library project to get you started.
 */

plugins {
    // Apply the Kotlin JVM plugin to add support for Kotlin on the JVM.
    id 'org.jetbrains.kotlin.jvm' version '1.3.11'
    id 'org.springframework.boot' version '2.1.3.RELEASE'
    id 'maven'
    id 'maven-publish' //该插件可以将打包的jar发送到maven库
}

apply plugin: 'io.spring.dependency-management'

version = "1.0.0.0-beta25"
group = "cn.com.scooper"


repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    mavenCentral()
    jcenter()
    maven {
        url = 'http://192.168.103.133:8080/repository/internal'
    }
}

dependencies {
    // Use the Kotlin JDK 8 standard library.
    implementation 'org.jetbrains.kotlin:kotlin-stdlib-jdk8'

    // Use the Kotlin test library.
    testImplementation 'org.jetbrains.kotlin:kotlin-test'

    // Use the Kotlin JUnit integration.
    testImplementation 'org.jetbrains.kotlin:kotlin-test-junit'
}

dependencies {
    compile "org.springframework.boot:spring-boot-starter"
}

dependencies {
    compile project(":kiswich-spring-boot-starter")
    compile project(":kiswich-spring-boot-base")
    compile project(":kiswich-spring-boot-autoconfigure")
}

allprojects {
    configurations {
        modules
        compile.extendsFrom(modules)
    }
}

subprojects {
    apply plugin: 'org.jetbrains.kotlin.jvm'
    apply plugin: 'java'
    apply plugin: 'maven'
    apply plugin: 'maven-publish'
    apply plugin: 'org.springframework.boot'
    apply plugin: 'io.spring.dependency-management'

    repositories {
        maven {
            url = 'http://192.168.103.133:8080/repository/internal'
        }
        mavenCentral()
    }

    group = rootProject.group
    version = rootProject.version

    bootJar.enabled = false
    
    jar{
        enabled = true
//        archiveName = "${baseName}-${appendix}-${version}.${extension}"
    }

    task sourcetype(type: Jar) {
        classifier = 'sources'
        from sourceSets.main.allSource
    }
    
    artifacts{
        archives jar
        archives sourcetype
    }

    dependencies {
        implementation "org.jetbrains.kotlin:kotlin-reflect:1.3.11"
        // Use the Kotlin JDK 8 standard library.
        implementation 'org.jetbrains.kotlin:kotlin-stdlib-jdk8'

        // Use the Kotlin test library.
        testImplementation 'org.jetbrains.kotlin:kotlin-test'

        // Use the Kotlin JUnit integration.
        testImplementation 'org.jetbrains.kotlin:kotlin-test-junit'
    }

    dependencies {
        compile "org.springframework.boot:spring-boot-starter"
        compile 'org.springframework.boot:spring-boot-starter-web'
    }

    dependencies {
        compile 'cn.com.scooper.common:scooper-common:1.0.24'
    }

    uploadArchives {
        repositories.mavenDeployer {
            repository(url: 'http://192.168.103.133:8080/repository/scooper-trial/') {// 仓库地址
// 这里配置上传账户的用户名和密码
                authentication(userName: scooperTrialUser, password: scooperTrialPwd)
            }
            
            pom.version = project.version
            pom.groupId = project.group
            pom.artifactId = project.name
        }
    }
}

bootJar.enabled = false
jar.enabled = true

project(":kiswich-spring-boot-starter") {
    apply plugin: "maven"
    apply plugin: "maven-publish"

    version = rootProject.version

//    task allJar(type: Jar, dependsOn: subprojects.tasks['classes'] ) {
//        baseName = 'allTests'
//        subprojects.each { subproject ->
//            from subproject.configurations.archives.allArtifacts.files.collect {
//                zipTree(it)
//            }
//        }
//    }
//    artifacts {
//        archives allJar
//    }
    publishing {
        publications {
            plugin(MavenPublication) {
                from components.java
                group project.group
                artifactId project.name
                version project.version
            }

        }
        repositories {
            maven {
                url = 'http://192.168.103.133:8080/repository/scooper-trial/'
                credentials {
                    username scooperTrialUser
                    password scooperTrialPwd
                }
            }
        }
    }
    
//    subprojects.each { subproject -> evaluationDependsOn(subproject.path) }

//    task allJar(type: Jar, dependsOn: subprojects.tasks["build"]) {
//        [
//                rootProject.project(":kiswich-spring-boot-autoconfigure"),
//                rootProject.project(":kiswich-spring-boot-base"),
//                rootProject.project(":kiswich-spring-boot-starter")
//        ].each { subproject ->
//            from subproject.configurations.archives.allArtifacts.files.collect {
//                zipTree(it)
//            }
//        }
//    }

}


